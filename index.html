<!DOCTYPE html>
<html>
<head>
  <title>SME Questionnaire Full Analysis Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; color: #333; }
    h1 { color: #1f4e79; }
    section { background: #fff; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input[type="number"], select, textarea { width: 100%; padding: 6px 8px; margin-top: 4px; border-radius: 4px; border: 1px solid #ccc; }
    input[type="radio"], input[type="checkbox"] { width: auto; margin-right: 6px; }
    button { margin-top: 12px; padding: 10px 15px; border: none; border-radius: 5px; background-color: #1f4e79; color: white; cursor: pointer; }
    button:hover { background-color: #3a6ea5; }
  </style>
</head>
<body>

<h1>SME Questionnaire – Full Analysis Tool</h1>

<section>
<form id="questionnaireForm">

  <h2>SECTION A: DEMOGRAPHICS</h2>

  <label>Gender</label>
  <input type="radio" name="gender" value="Male" required> Male
  <input type="radio" name="gender" value="Female"> Female

  <label>Age Range</label>
  <select name="age" required>
    <option value="">Select</option>
    <option>Below 25</option><option>25–34</option><option>35–44</option>
    <option>45–54</option><option>55–64</option><option>65+</option>
  </select>

  <label>Years in Business</label>
  <select name="years" required>
    <option value="">Select</option>
    <option>Less than 5</option><option>5–10</option><option>11–20</option><option>20+</option>
  </select>

  <label>Business Sector</label>
  <select name="sector" required>
    <option value="">Select</option>
    <option>Agriculture/Agro Processing</option><option>Retail/Trading</option>
    <option>Manufacturing</option><option>Services</option><option>Other</option>
  </select>

  <label>Number of Employees</label>
  <select name="employees" required>
    <option value="">Select</option>
    <option>1–10</option><option>11–49</option><option>50–99</option><option>100–249</option>
  </select>

  <label>Location in Kogi State</label>
  <select name="location" required>
    <option value="">Select</option>
    <option>Lokoja</option><option>Adavi</option><option>Koton-Karfe</option>
  </select>

  <h2>SECTION B: IMPACT OF DIGITALIZATION</h2>
  <p><strong>Scale:</strong> 1 = Strongly Agree, 2 = Agree, 3 = Neutral, 4 = Disagree, 5 = Strongly Disagree</p>

  <label>b1. Digital tools improved sales</label><input type="number" name="b1" min="1" max="5" required>
  <label>b2. Digitalization is important for survival</label><input type="number" name="b2" min="1" max="5" required>
  <label>b3. Digitalization reduced operational cost</label><input type="number" name="b3" min="1" max="5" required>
  <label>b4. Customer satisfaction increased</label><input type="number" name="b4" min="1" max="5" required>

  <h2>SECTION C: CHALLENGES</h2>
  <p><strong>Scale:</strong> 1 = Strongly Agree, 2 = Agree, 3 = Neutral, 4 = Disagree, 5 = Strongly Disagree</p>

  <label>c1. High cost limits adoption</label><input type="number" name="c1" min="1" max="5" required>
  <label>c2. Poor internet affects usage</label><input type="number" name="c2" min="1" max="5" required>
  <label>c3. Lack of digital skills</label><input type="number" name="c3" min="1" max="5" required>
  <label>c4. Cybersecurity risks</label><input type="number" name="c4" min="1" max="5" required>
  <label>c5. Government support inadequate</label><input type="number" name="c5" min="1" max="5" required>

  <h2>SECTION D: DIGITAL TOOLS & INFRASTRUCTURE</h2>

  <label>d1. Market reach expanded</label><input type="number" name="d1" min="1" max="5" required>
  <label>d2. Business productivity increased</label><input type="number" name="d2" min="1" max="5" required>

  <label>d3. Digital tools used</label>
  <input type="checkbox" name="d3" value="Social Media"> Social Media
  <input type="checkbox" name="d3" value="E-commerce"> E-commerce
  <input type="checkbox" name="d3" value="POS"> POS
  <input type="checkbox" name="d3" value="Accounting"> Accounting Software
  <input type="checkbox" name="d3" value="Inventory"> Inventory Tools
  <input type="checkbox" name="d3" value="Data-Analytics"> Data Analytics
  
  <label>d4. Frequency of use</label>
  <select name="d4" required>
    <option value="">Select</option><option>Daily</option><option>Weekly</option><option>Monthly</option><option>Rarely</option>
  </select>

  <label>d5. Business has required digital skills</label><input type="number" name="d5" min="1" max="5" required>

  <h2>SECTION E: STRATEGIES</h2>

  <label>e1. Would you like digital training?</label>
  <input type="radio" name="e1" value="Yes" required> Yes
  <input type="radio" name="e1" value="No"> No

  <label>e2. Support needed</label>
  <input type="checkbox" name="e2" value="Tools"> Tools
  <input type="checkbox" name="e2" value="Internet"> Better Internet
  <input type="checkbox" name="e2" value="Funding"> Govt Funding
  <input type="checkbox" name="e2" value="Training"> Training
  <input type="checkbox" name="e2" value="ICT"> ICT Experts

  <label>e3. Preparedness for digital expansion</label>
  <select name="e3" required>
    <option value="">Select</option><option>Very Prepared</option><option>Prepared</option><option>Unsure</option><option>Not Prepared</option>
  </select>

  <label>Additional Comments</label>
  <textarea name="comments" rows="3"></textarea>

  <button type="submit">Submit Response</button>
</form>
</section>

<section>
<button id="downloadCsv">Download CSV (Data + Analysis)</button>
</section>

<script>
let responses = [];

const numericQuestions = ["b1","b2","b3","b4","c1","c2","c3","c4","c5","d1","d2","d5"];
const checkboxFields = ["d3","e2"];

function mean(a){return a.reduce((x,y)=>x+y,0)/a.length;}
function std(a){const m=mean(a);return Math.sqrt(a.reduce((s,v)=>s+(v-m)**2,0)/a.length);}
function corr(x,y){const mx=mean(x), my=mean(y); let n=0,dx=0,dy=0; for(let i=0;i<x.length;i++){n+=(x[i]-mx)*(y[i]-my);dx+=(x[i]-mx)**2;dy+=(y[i]-my)**2;} return n/Math.sqrt(dx*dy);}

questionnaireForm.onsubmit = e => {
  e.preventDefault();
  const fd = new FormData(questionnaireForm);
  const entry = {};

  checkboxFields.forEach(f => entry[f] = fd.getAll(f).join("; "));
  for(const [k,v] of fd.entries()) if(!checkboxFields.includes(k)) entry[k]=v;

  responses.push(entry);
  alert("Response saved. Total responses: " + responses.length);
  questionnaireForm.reset();
};

function downloadCSV(){
  if(!responses.length) return alert("No data available");

  const headers = Object.keys(responses[0]);
  let csv = [headers.join(",")];

  responses.forEach(r=>csv.push(headers.map(h=>r[h]||"").join(",")));

  csv.push("","Descriptive Statistics");
  numericQuestions.forEach(q=>{
    const arr = responses.map(r=>+r[q]).filter(n=>!isNaN(n));
    csv.push(`${q},Mean,${mean(arr).toFixed(2)},StdDev,${std(arr).toFixed(2)}`);
  });

  csv.push("","Correlation Matrix");
  for(let i=0;i<numericQuestions.length;i++){
    for(let j=i+1;j<numericQuestions.length;j++){
      const x = responses.map(r=>+r[numericQuestions[i]]);
      const y = responses.map(r=>+r[numericQuestions[j]]);
      csv.push(`${numericQuestions[i]} vs ${numericQuestions[j]},${corr(x,y).toFixed(3)}`);
    }
  }

  const blob = new Blob([csv.join("\n")],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="SME_Full_Analysis.csv";
  a.click();
}

downloadCsv.onclick = downloadCSV;
</script>

</body>
</html>
